% Copyright (c) 2016-2020 Jakob Meng, <jakobmeng@web.de>

% TODO: Translate everything into english.
% TODO: Give reasons for package inclusion order.
% TODO: Motivate packages. Why are they included?
% TODO: Maybe add missing packages from master thesis latex document?

\usepackage{etex} % increases the number of registers and thus prevents latex errors like '! No room for a new \<thing>...'

\usepackage[T1]{fontenc} % Nutzung der erweiterten Zeichensaetze. 
\usepackage[utf8]{inputenc} % fuer die Nutzung deutscher Umlauten (Windows)

\usepackage[
    english, % secondary language
    ngerman  % primary language
]{babel} % hyphenation
\usepackage{hyphenat} % Provides \hyp{}, used instead of hyphens, to break compound words between lines.
\usepackage[ngerman=ngerman-x-latest]{hyphsubst} % improved hyphenation
\usepackage{translator} % translate individual words into different languages

\usepackage{amsmath} % mathematischer Formelsatz
\usepackage{mathtools} % extension to amsmath with tools for mathematical typesetting
\usepackage{amsthm} % fuer die Saetze / Theoreme (z.B. \newtheorem{}

\usepackage{lmodern} % Latin Modern are a handmade vectorization of cm bitmap fonts
%\usepackage{inconsolata} % Google Fonts Inconsolata
\usepackage{latexsym} % wichtig, fuer die mathematischen Sonderzeichen 
\usepackage{amssymb} % e.g. \square
\usepackage{stmaryrd} % e.g. \rightarrowtriangle
\usepackage{arevmath} % Arev Sans fonts, e.g. \warning
\usepackage[weather,misc]{ifsym} % Für \Radiation, \Sun ...
\usepackage{textcomp} % Text Companion fonts, e.g. \textquotesingle
\usepackage{oz} % e.g. \bij
\usepackage{bbm} % Black­board vari­ants of Com­puter Modern fonts
%\usepackage{musicography} % for music symbols, package is not in Debian Stretch and earlier

\usepackage{graphicx} % wichtig, um externe Grafiken einbinden zu koennen

%\usepackage[normalem]{ulem} % e.g. \uline{} for underlining words
%
% ulem normally replaces italics with underlining in textemphasized  by \emph, and to some extent by \em.
% A declaration of \normalem or the \usepackage option [normalem] disables this feature.
%
% NOTE: Every word is typeset in an underlined box, so automatic hyphenationis disabled,
%       but explicit discretionary hyphens (\-) will still be obeyed. This causes problems
%       e.g. with long titles in bibliography entries!
%
% Ref.: http://mirrors.ctan.org/macros/latex/contrib/ulem/ulem.pdf

\usepackage[usenames,dvipsnames,svgnames]{xcolor} % Fügt weitere Farben mit Namen hinzu, muss vor dem tikz package eingebunden werden, damit das tikz package die Namen nutzen kann

\usepackage{enumitem} % Control layout of itemize, enumerate, description. NOTE: Incompatible with beamer!

% set page dimensions, e.g. using
% \geometry{left=20mm,right=20mm, top=20mm, bottom=5mm, includeheadfoot}
\usepackage[a4paper]{geometry}

%setzt Helvetica als Standardschriftart im gesamten Dokument. Arial ist lediglich eine Nachahmung von Helvetica mit geringen Unterschieden. 
%http://www.faqs.org/faqs/de-tex-faq/part10/
\renewcommand{\familydefault}{\sfdefault}
\usepackage{helvet}

\usepackage{microtype}
%\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true]{microtype}
%\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=1100,stretch=10,shrink=10]{microtype}
% activate={true,nocompatibility} - activate protrusion and expansion
% final - enable microtype; use "draft" to disable
% tracking=true, kerning=true, spacing=true - activate these techniques
% factor=1100 - add 10% to the protrusion amount (default is 1000)
% stretch=10, shrink=10 - reduce stretchability/shrinkability (default is 20/20)
% Quelle: http://www.khirevich.com/latex/microtype/

% Zeilenabstand einstellen, z.B.
%  \singlespacing
%  \onehalfspacing % 1.5-facher Zeilenabstand
%  \doublespacing
%  \spacing{n}
%
% NOTE: \linespread is evil, better use e.g. \onehalfspacing or \singlespacing
%       Ref.: ftp://ftp.dante.de/tex-archive/info/german/l2tabu/l2tabu.pdf
\usepackage{setspace}

\usepackage{float} % fuer Listen mit \newfloat

\usepackage{tikz} % Zum Zeichnen von z.B. einer Klammer neben itemize oder von Zeichnung, die aus Dia exportiert wurden.
%\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{decorations.pathreplacing,calc,positioning,shapes.geometric}

\usepackage[%pdfview=FitH,
            %pdfstartview=FitH,
            colorlinks=true,
            linkcolor=black,
            citecolor=black,
            menucolor=black,
            urlcolor=black,
            breaklinks=true,
            %plainpages=false,
            bookmarksopen=true
           ]{hyperref} % Mächtige Alternative zum url package.

\usepackage[numbered=false]{bookmark} % e.g. enable/disable numbering in PDF bookmarks/toc

\usepackage[
            backend=biber,
            %style=trad-abbrv,
            %style=trad-alpha,
            %style=authoryear,
            hyperref=true,
            %dashed=false, % Unterdrückt den Strich im Literaturverzeichnis bei mehreren Literaturangaben zum gleichen Autor
            mincitenames=1, 
            %maxcitenames=1, % Zeigt bei Literaturhinweisen nur einen Autor an
            maxbibnames=99, % Zeigt im Literaturverzeichnis alle Autoren an
            isbn=false,url=false,doi=false,eprint=false, % Biblatex Manual "3.1.2.2 Style-specific"
           ]{biblatex}

\usepackage[
            babel,
            %german=guillemets
            %german=quotes
           ]{csquotes}

\usepackage{ragged2e} % Erlaubt z.B. Linksbündiges Literaturverzeichnis
\usepackage{units} % Für Einheiten und schräge Bruchstriche mit \nicefrac{}{} oder \unitfrac{}{}

\usepackage{newunicodechar}

\usepackage{listings}
%\usepackage{minted} % Syntax Highlighting (ACHTUNG: Unterstützt keine deutschen Sonderzeichen wie ä,ö,ü!)
%\usemintedstyle{autumn}

\usepackage{multimedia} % for \movie...

\usepackage{wrapfig} % Erlaubt Wrappen von Text neben Abbildungen

\usepackage{scrhack} % KOMA-Script improvements, loaded at the end due to problems with e.g. package minted
\usepackage[headsepline]{scrlayer-scrpage} % Page headers and footers for KOMA-Script, scrpage2 is obsolete now.

\usepackage{subcaption} %für begin{subfigure} etc.
\usepackage{fancyvrb} % supports enhanced verbatim features, e.g. \begin{Verbatim}

\usepackage{blkarray} % for \begin{blockarray}, see https://tex.stackexchange.com/a/59519/128708

% \xspace should be used at the end of a macro designed to be used mainly in text.
% It adds a space unless the macro is followed by certain punctuation characters.
%
% NOTE: The original \xspace author does recommend NOT to use it!
%       Ref.: https://tex.stackexchange.com/a/86620/128708
\usepackage{xspace}

\usepackage{algorithm, algpseudocode} % Typesetting algorithms using pseudo code

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Extensions for algorithmic environments

% new MATLAB macro block for algorithm environment
% Ref.: https://tex.stackexchange.com/questions/19982/how-do-i-add-parfor-in-algorithmic-environment/20004#20004
\algblock{Macro}{EndMacro}
\algnewcommand\algorithmicmacro{\textbf{macro}}
\algnewcommand\algorithmicendmacro{\textbf{end\ macro}}
\algrenewtext{Macro}[1]{\algorithmicmacro{} \uppercase{#1}}
\algrenewtext{EndMacro}{\algorithmicendmacro}
%
\algblock{MatlabFunction}{EndMatlabFunction}
\algnewcommand\algorithmicmatlabfunction{\textbf{function}}
\algnewcommand\algorithmicendmatlabfunction{\textbf{end\ function}}
\algrenewtext{MatlabFunction}[3]{\algorithmicmatlabfunction{} [#1] = \uppercase{#2}(#3)}
\algrenewtext{EndMatlabFunction}{\algorithmicendmatlabfunction}



% TODO: Explain \Description and show its usage.
% Ref.: /usr/share/texlive/texmf-dist/tex/latex/algorithmicx/algorithmicx.sty
\newcommand{\Description}[1]{%
    \item[]\hspace{-\listparindent}
    \parbox[t]{\linewidth+\listparindent}{
        \leftskip=\listparindent
        \parindent=-\listparindent
        \textbf{Description:} #1
    }%
}

% Ref.: https://tex.stackexchange.com/a/63667
% Comment using the right half of the text
\newcommand{\CommentRH}[1]{%
    \Comment{\parbox[t]{.5\linewidth}{#1}}%
}
% Comment using the full text width and new line
\newcommand{\LineComment}[1]{%
    \Statex \Comment{\parbox[t]{0.95\linewidth}{#1}}
}
% \algnewcommand{\LineComment}[1]{\State \(\triangleright\) #1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Sign for ESTIMATES ≙ U+2259
% Reference: https://tex.stackexchange.com/a/170101
\makeatletter
%
% \hateq from MnSymbol
% \usepackage{MnSymbol}
\@ifpackageloaded{MnSymbol}\@tempswafalse\@tempswatrue
\if@tempswa
  \DeclareFontFamily{U}{MnSymbolD}{}%
  \DeclareSymbolFont{MnSyD}{U}{MnSymbolD}{m}{n}%
  \SetSymbolFont{MnSyD}{bold}{U}{MnSymbolD}{b}{n}%
  \DeclareFontShape{U}{MnSymbolD}{m}{n}{
      <-6>  MnSymbolD5
     <6-7>  MnSymbolD6
     <7-8>  MnSymbolD7
     <8-9>  MnSymbolD8
     <9-10> MnSymbolD9
    <10-12> MnSymbolD10
    <12->   MnSymbolD12}{}%
  \DeclareFontShape{U}{MnSymbolD}{b}{n}{
      <-6>  MnSymbolD-Bold5
     <6-7>  MnSymbolD-Bold6
     <7-8>  MnSymbolD-Bold7
     <8-9>  MnSymbolD-Bold8
     <9-10> MnSymbolD-Bold9
    <10-12> MnSymbolD-Bold10
    <12->   MnSymbolD-Bold12}{}%
  \DeclareMathSymbol{\hateq}{\mathrel}{MnSyD}{61}% 
\fi
\makeatother

\definecolor{pblue}{rgb}{0.13,0.13,1}
\definecolor{pgreen}{rgb}{0,0.5,0}
\definecolor{pred}{rgb}{0.9,0,0}
\definecolor{pgrey}{rgb}{0.46,0.45,0.48}

\definecolor{diffstart}{named}{Grey}
\definecolor{diffincl}{named}{Green}
\definecolor{diffrem}{named}{OrangeRed}

\newcommand{\ultriangle}{
\tikz[baseline=-.0ex]{\draw (0,0) -- (.66em,0) -- (0,.66em) -- (0,0);}
} % upper left triangle (^^e2^^97^^b8)
\newcommand{\urtriangle}{
\tikz[baseline=-.0ex]{\draw (.66em,0) -- (.66em,.66em) -- (0,.66em) -- (.66em,0);}
} % upper right triangle (^^e2^^97^^b9)
\newcommand{\lltriangle}{
\tikz[baseline=-.0ex]{\draw (0,0) -- (0,.66em) -- (.66em,0) -- (0,0);}
} % lower left triangle (^^e2^^97^^ba)
\newcommand{\lrtriangle}{
\tikz[baseline=-.0ex]{\draw (0,0) -- (.66em,.66em) -- (.66em,0) -- (0,0);}
} % lower right triangle (^^e2^^97^^bf)

% TODO: Add unicode chars, e.g. all greek unicode letters.
% TODO: Move unicode character declation to separate file?
%\newunicodechar{≙}{\ensuremath{\mathrel{\hat=}}}
\newunicodechar{≙}{\ensuremath{\hateq}}
\newunicodechar{≈}{\ensuremath{\approx}}
\newunicodechar{≤}{\ensuremath{\leq}}
\newunicodechar{≥}{\ensuremath{\geq}}
\newunicodechar{≪}{\ensuremath{\ll}}
\newunicodechar{∈}{\ensuremath{\in}}
\newunicodechar{ℕ}{\ensuremath{\mathbb{N}}}
\newunicodechar{α}{\ensuremath{\alpha}}
\newunicodechar{𝛽}{\ensuremath{\mathit{\beta}}} % TODO: Replace \beta with correct character for U+1D6FD
\newunicodechar{β}{\ensuremath{\beta}}
\newunicodechar{ϵ}{\ensuremath{\epsilon}}
\newunicodechar{ε}{\ensuremath{\varepsilon}}
\newunicodechar{σ}{\ensuremath{\sigma}}
\newunicodechar{τ}{\ensuremath{\tau}}
\newunicodechar{θ}{\ensuremath{\theta}}
\newunicodechar{𝛴}{\ensuremath{\mathit{\Sigma}}} % TODO: Replace \Sigma with correct character for U+1D6F4
\newunicodechar{μ}{\ensuremath{\mu}}
\newunicodechar{→}{\ensuremath{\rightarrow}}
\newunicodechar{↓}{\ensuremath{\downarrow}}
\newunicodechar{×}{\ensuremath{\times}}
\newunicodechar{≡}{\ensuremath{\equiv}}
\newunicodechar{√}{\ensuremath{\surd}}%\textsurd
\newunicodechar{Σ}{\ensuremath{\Sigma}}
\newunicodechar{⇽}{\ensuremath{\leftarrowtriangle}}
\newunicodechar{⇾}{\ensuremath{\rightarrowtriangle}}
\newunicodechar{♯}{\ensuremath{\sharp}} % correct would be \musSharp{} from \usepackage{musicography} which is not in Debian Stretch or earlier.
\newunicodechar{ℝ}{\ensuremath{\mathbb{R}}}
\newunicodechar{ℂ}{\ensuremath{\mathbb{C}}}
\newunicodechar{ℤ}{\ensuremath{\mathbb{Z}}}
\newunicodechar{ℚ}{\ensuremath{\mathbb{ℚ}}}
\newunicodechar{⎣}{\ensuremath{\lfloor}}
\newunicodechar{⎦}{\ensuremath{\rfloor}}
\newunicodechar{⎡}{\ensuremath{\lceil}}
\newunicodechar{⎤}{\ensuremath{\rceil}}
\newunicodechar{⚠}{\ensuremath{\warning}}
\newunicodechar{⤖}{\ensuremath{\bij}}
\newunicodechar{◸}{\ultriangle}
\newunicodechar{◹}{\urtriangle}
\newunicodechar{◺}{\lltriangle}
\newunicodechar{◿}{\lrtriangle}
\newunicodechar{∆}{\ensuremath{\Delta}} % TODO: Replace \Delta with correct character for U+2206
\newunicodechar{⇐}{\ensuremath{\Leftarrow}}
\newunicodechar{⇒}{\ensuremath{\Rightarrow}}
\newunicodechar{↔}{\ensuremath{\leftrightarrow}}
\newunicodechar{⇔}{\ensuremath{\Leftrightarrow}}
\newunicodechar{∧}{\ensuremath{\wedge}}
\newunicodechar{∨}{\ensuremath{\vee}}
\newunicodechar{ω}{\ensuremath{\omega}}
\newunicodechar{∞}{\ensuremath{\infty}}
\newunicodechar{Φ}{\ensuremath{\Phi}}
\newunicodechar{ϕ}{\ensuremath{\phi}}
\newunicodechar{φ}{\ensuremath{\varphi}}
\newunicodechar{Λ}{\ensuremath{\Lambda}}
\newunicodechar{λ}{\ensuremath{\lambda}}

\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\length}{length}
\DeclareMathOperator{\house}{house}
\DeclareMathOperator{\G}{G}
\DeclareMathOperator{\tol}{tol}

% Symbol for Programming Language C#
% Ref.: http://tex.stackexchange.com/a/44540
%\newcommand{\Csh}{C{$^\sharp$}}
\newcommand{\Csh}{C\#}
%\newcommand{\Csh}{C\includegraphics{hash-symbol}}

% Symbol for Programming Language C++
% Ref.:
%  https://tex.stackexchange.com/questions/4302/prettiest-way-to-typeset-c-cplusplus
\newcommand\CC{C\nolinebreak\hspace{-.05em}\raisebox{.4ex}{\relsize{-3}{\textbf{+}}}\nolinebreak\hspace{-.10em}\raisebox{.4ex}{\relsize{-3}{\textbf{+}}}}
%\newcommand\CC{C\nolinebreak[4]\hspace{-.05em}\raisebox{.4ex}{\relsize{-3}{\textbf{++}}}}
%
%\newcommand{\Rplus}{\protect\hspace{-.1em}\protect\raisebox{.35ex}{\smaller{\smaller\textbf{+}}}}
%\newcommand{\Cpp}{\mbox{C\Rplus\Rplus}\xspace}

\newtheorem{theorem}{\translate{theorem}}
\newtheorem{definition}[theorem]{\translate{definition}}
\newtheorem{remark}[theorem]{\translate{remark}}
\newtheorem{lemma}[theorem]{\translate{lemma}}
\newtheorem{example}[theorem]{\translate{example}}

\newtheorem{hypothesis}{\translate{hypothesis}}
\newtheorem{subhypothesis}{\translate{subhypothesis}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Typesetting C++ code

\lstset{
    language={[11]C++},
%     %language=bash,
     basicstyle=\ttfamily\small,
     numberstyle=\footnotesize,
     numbers=left,
     backgroundcolor=\color{gray!5},
%      frame=single,
    frame=tb,
     tabsize=2,
     rulecolor=\color{black!30},
     %title=\lstname,
%     escapeinside={\%*}{*)},
     escapeinside={(*@}{@*)},
%     breaklines=true,
%     breakatwhitespace=true,
%     framextopmargin=2pt,
%     framexbottommargin=2pt,
%     inputencoding=utf8,
%     extendedchars=true,
%
    %aboveskip=0em,
    %belowskip=0em,
    xleftmargin=1.5em,
    xrightmargin=2pt,
    %framexleftmargin=1.5em, % line numbers inside paragraph
    numbersep=6pt,
    %columns=fullflexible,
    showspaces=false,
    showtabs=false,
    breaklines=true,
    showstringspaces=false,
    breakatwhitespace=true,
    commentstyle=\color{pgreen},
    keywordstyle=\color{pblue},
    stringstyle=\color{pred},
    moredelim=[il][\textcolor{pgrey}]{\$\$},
    moredelim=[is][\textcolor{pgrey}]{\%\%}{\%\%},
    extendedchars=true,
    literate=
        {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
        {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
        {à}{{\`a}}1 {è}{{\`e}}1 {ì}{{\`i}}1 {ò}{{\`o}}1 {ù}{{\`u}}1
        {À}{{\`A}}1 {È}{{\'E}}1 {Ì}{{\`I}}1 {Ò}{{\`O}}1 {Ù}{{\`U}}1
        {ä}{{\"a}}1 {ë}{{\"e}}1 {ï}{{\"i}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
        {Ä}{{\"A}}1 {Ë}{{\"E}}1 {Ï}{{\"I}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
        {â}{{\^a}}1 {ê}{{\^e}}1 {î}{{\^i}}1 {ô}{{\^o}}1 {û}{{\^u}}1
        {Â}{{\^A}}1 {Ê}{{\^E}}1 {Î}{{\^I}}1 {Ô}{{\^O}}1 {Û}{{\^U}}1
        {œ}{{\oe}}1 {Œ}{{\OE}}1 {æ}{{\ae}}1 {Æ}{{\AE}}1 {ß}{{\ss}}1
        {ű}{{\H{u}}}1 {Ű}{{\H{U}}}1 {ő}{{\H{o}}}1 {Ő}{{\H{O}}}1
        {ç}{{\c c}}1 {Ç}{{\c C}}1 {ø}{{\o}}1 {å}{{\r a}}1 {Å}{{\r A}}1
        {€}{{\EUR}}1 {£}{{\pounds}}1
        {↓}{{$\downarrow$}}1,
    captionpos=b,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Typesetting diff files
% Ref.: https://tex.stackexchange.com/a/106129

\lstdefinelanguage{diff}{
    basicstyle=\ttfamily\small,
    morecomment=[f][\color{diffstart}]{@@},
    morecomment=[f][\color{diffincl}]{+},
    morecomment=[f][\color{diffrem}]{-},
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usedictionary{language}
% TODO: Move \hyphenation commands to separate files, e.g. same as with dictionaries
%\hyphenation{Lauf-zeit}

\bibliography{bibliography/references.bib}

% Wie kann ich ,Hurenkinder` (engl. widows), also einzelne Zeilen eines Absatzes am Kopf von Buchseiten,
% bzw. ,Schusterjungen/Waisenkinder` (engl. clubs), einzelne Absatzzeilen auf der Seite unten, verhindern?
% Ref.:
%  http://projekte.dante.de/DanteFAQ/hyphenation#4
%  https://en.wikibooks.org/wiki/LaTeX/Page_Layout#Widows_and_orphans
\clubpenalty=300
\widowpenalty=300
\displaywidowpenalty=300

% Rename abstract heading when using babel
%\addto{\captionsngerman}{\renewcommand{\abstractname}{Abriss}}
%\addto{\captionsngerman}{\renewcommand{\abstractname}{Abstract}}

% Renaming the bibliography page using BibTeX, ref.: https://tex.stackexchange.com/a/12612
%\renewcommand{\bibname}{Whatever floats your boat}
%\addto{\captionsngerman}{\renewcommand{\bibname}{Literaturverzeichnis}}

% Change "Algorithm" in caption of algorithms
% Ref.: https://tex.stackexchange.com/a/230498/128708
\makeatletter
\floatname{algorithm}{Algorithmus}
%\renewcommand*{\ALG@name}{Algorithmus}
\makeatother

% Der Befehl \raggedbottom sorgt dafür, dass kein Ausgleich des unteren Seitenrandes durch Dehnung der Absatzabstände durchgeführt wird.
% Ref.: http://tex.stackexchange.com/questions/10743/why-does-latex-stretch-small-sections-across-the-whole-page-vertically/10747#10747
\raggedbottom

% Add an extra level of sections with headings below \subsubsection
% Refs.:
%  https://tex.stackexchange.com/a/186982
%  https://tex.stackexchange.com/questions/60209/how-to-add-an-extra-level-of-sections-with-headings-below-subsubsection
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}

% Setup header and footer
\pagestyle{scrheadings}
\chead{}
\ohead{\pagemark}
\ihead{\headmark}
\automark{section}
\cfoot{}
\ofoot{}

% no indentation at beginning of paragraphs
\setlength{\parindent}{0ex} 

% paragraph spacing, determines the space between a paragraph and the preceding text
\setlength{\parskip}{0.5\baselineskip}

\theoremstyle{definition}
